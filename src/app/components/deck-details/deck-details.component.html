<section class="mt-[10vh]">

    <app-filters></app-filters>

    <app-card></app-card>

    <!-- AFFICHAGE CARTES -->

    <div class="w-full flex flex-col items-center">

        <button class="tw_btn w-11/12 fixed top-[10vh]" (click)="goBack()">Go back</button>

        <table class="mt-[12vh] w-full text-left">
            <tbody>

                <tr>
                    <th colspan="2" class="tw_th">Global</th>
                </tr>

                <tr>
                    <td class="tw_td_label">Nb cards</td>
                    <td class="tw_td_value">{{ deckStats.get('nbCards') }}</td>

                </tr>

                <tr>
                    <td class="tw_td_label">Price std ($)</td>
                    <td class="tw_td_value">{{ deckStats.get('deckPrice') }}</td>

                </tr>

                <tr>
                    <td class="tw_td_label">Inkwell</td>
                    <td class="tw_td_value">{{ deckStats.get('inkwell') }} |
                        {{ (deckStats.get('inkwell') || 0) / (deckStats.get('nbCards') || 1)
                        * 100 | number:
                        '1.2-2' }}%</td>

                </tr>

                <tr>
                    <td class="tw_td_label">Non-ikwell</td>
                    <td class="tw_td_value">{{ deckStats.get('nbCards')!-deckStats.get('inkwell')! }} |
                        {{ (deckStats.get('nbCards')!-deckStats.get('inkwell')! || 0) / (deckStats.get('nbCards') || 1)
                        * 100 | number:
                        '1.2-2' }}%</td>
                </tr>

                <tr>
                    <th colspan="2" class="tw_th">Inks</th>
                </tr>

                <tr *ngFor="let stat of getSortedCategory('inks_') ; let i=index">
                    <td *ngIf="stat.key.startsWith('inks_')" class="tw_td_label">
                        <img [src]="'assets/images/colors/' + getLabel(stat.key) + '.png'" alt="Amber"
                            class="inline-block w-7 h-8" />
                        {{getLabel(stat.key)}} :
                    </td>
                    <td *ngIf="stat.key.startsWith('inks_')" class="tw_td_value">{{ stat.value }} |
                        {{ (stat.value || 0) / (deckStats.get('nbCards') || 1) * 100 | number:
                        '1.2-2' }}%</td>

                </tr>

                <tr>
                    <th colspan="2" class="tw_th">Type</th>
                </tr>
                <tr *ngFor="let stat of getSortedCategory('type_') ; let i=index">
                    <td *ngIf="stat.key.startsWith('type_')" class="tw_td_label">{{
                        getLabel(stat.key)}}</td>
                    <td *ngIf="stat.key.startsWith('type_')" class="tw_td_value">{{ stat.value }} |
                        {{ (stat.value || 0) / (deckStats.get('nbCards') || 1) * 100 | number:
                        '1.2-2' }}%</td>

                </tr>
                <tr>
                    <th colspan="2" class="tw_th">Classifications</th>
                </tr>
                <tr *ngFor="let stat of getSortedCategory('clas_') ; let i=index">
                    <td *ngIf="stat.key.startsWith('clas_')" class="tw_td_label">{{
                        getLabel(stat.key)}}</td>
                    <td *ngIf="stat.key.startsWith('clas_')" class="tw_td_value">{{ stat.value }} |
                        {{ (stat.value || 0) / (deckStats.get('nbCards') || 1) * 100 | number:
                        '1.2-2' }}%</td>

                </tr>

                <tr>
                    <th colspan="2" class="tw_th">Keywords</th>
                </tr>
                <tr *ngFor="let stat of getSortedCategory('keyw_') ; let i=index">
                    <!-- <tr *ngFor="let stat of deckStats | keyvalue ; let i=index"> -->
                    <td *ngIf="stat.key.startsWith('keyw_')" class="tw_td_label">{{
                        getLabel(stat.key)}}</td>
                    <td *ngIf="stat.key.startsWith('keyw_')" class="tw_td_value">{{ stat.value }} |
                        {{ (stat.value || 0) / (deckStats.get('nbCards') || 1) * 100 | number:
                        '1.2-2' }}%</td>

                </tr>

                <tr>
                    <th colspan="2" class="tw_th">Rarity</th>
                </tr>
                <tr *ngFor="let stat of getSortedCategory('rari_') ; let i=index">
                    <td *ngIf="stat.key.startsWith('rari_')" class="tw_td_label">{{
                        getLabel(stat.key)}}</td>
                    <td *ngIf="stat.key.startsWith('rari_')" class="tw_td_value">{{ stat.value }} |
                        {{ (stat.value || 0) / (deckStats.get('nbCards') || 1) * 100 | number:
                        '1.2-2' }}%</td>

                </tr>


            </tbody>
        </table>
    </div>


    <div class="flex flex-wrap justify-center pb-[12vh]">



        <div *ngFor="let deckCard of deckCards; let i = index" class="p-2 w-1/2 md:w-1/4 lg:w-1/6 relative">

            <div *ngIf="deckCard?.getCard()?.getImageUris()?.getDigital()?.getNormal() == null"
                class="w-full h-60 flex items-center justify-center bg-white rounded-xl">
                <div class="animate-spin rounded-full h-6 w-6 border-4 border-fuchsia-400 border-t-transparent"></div>
            </div>

            <img *ngIf="deckCard?.getCard()?.getImageUris()?.getDigital()?.getNormal() !== null"
                [attr.alt]="deckCard?.getCard()?.getName() || 'card'"
                class="z-10 h-full w-full rounded-lg object-contain transform transition-all duration-200 hover:scale-105 hover:cursor-pointer hover:shadow-2xl"
                [src]="deckCard?.getCard()?.getImageUris()?.getDigital()?.getNormal()  || 'assets/cardBack.avif'"
                [attr.loading]="i > 5 ? 'lazy' : 'eager'" (click)="showCardDetails(deckCard.getCard())">

            <p>{{getQuantity(deckCard.getCard().getCardIdBdd())}}</p>
            <p>{{getPrice(deckCard.getCard().getCardIdBdd())}}</p>


        </div>

    </div>

</section>